```troff
.TH CHECKPOINT 1 "September 2025" "Version 1.6.0" "User Commands"
.SH NAME
checkpoint, chkpoint \- create, manage, and restore timestamped snapshots of directories
.SH SYNOPSIS
.B checkpoint
[\fIoptions\fR] [\fIdirectory\fR]
.br
.B checkpoint
\fB\-\-restore\fR [\fB\-\-from\fR \fIcheckpoint\fR] [\fB\-\-to\fR \fIdirectory\fR]
.br
.B checkpoint
\fB\-\-list\fR [\fB\-d\fR \fIdirectory\fR]
.br
.B checkpoint
\fB\-\-compare\-with\fR \fIcheckpoint\fR [\fB\-\-detailed\fR]
.br
.B checkpoint
\fB\-\-remote\fR \fIuser@host:/path\fR [\fIoptions\fR]
.SH DESCRIPTION
.B checkpoint
is a powerful cross-platform utility for creating, managing, and restoring timestamped snapshots of directories.
Designed for developers, system administrators, and DevOps engineers who need reliable recovery points during
iterative development and system configuration changes.
.PP
Checkpoint bridges the gap between informal backup practices and enterprise-grade snapshot management by providing
simple commands for complex operations. Create recovery points before risky changes, track development progress
through organized snapshots, and quickly restore when needed.
.PP
The utility intelligently selects backup directories based on user privileges:
.IP \(bu 2
Root/sudo users: \fB/var/backups/\fIDIR_NAME\fR/
.IP \(bu 2
Regular users: \fB~/.checkpoint/\fIDIR_NAME\fR/
.IP \(bu 2
Custom: \fB$CHECKPOINT_BACKUP_DIR/\fIDIR_NAME\fR/
.SH OPTIONS
.SS Core Options
.TP
.B \-d, \-\-backup\-dir \fIDIR\fR
Specify custom backup location. Default is /var/backups/DIR_NAME for root users,
~/.checkpoint/DIR_NAME for regular users.
.TP
.B \-s, \-\-suffix \fISUFFIX\fR
Add descriptive suffix to checkpoint name.
.TP
.B \-q, \-\-quiet
Minimal output showing just the backup path.
.TP
.B \-v, \-\-verbose
Detailed output with progress information (default).
.TP
.B \-l, \-\-list
List existing checkpoints with sizes and metadata.
.TP
.B \-\-help
Display help message and exit.
.TP
.B \-\-version
Display version information and exit.
.SS Backup Management Options
.TP
.B \-\-keep \fIN\fR
Keep only N most recent backups, removing older ones.
.TP
.B \-\-age \fIDAYS\fR
Remove backups older than DAYS days.
.TP
.B \-\-exclude \fIPATTERN\fR
Additional exclusion pattern for rsync. Can be specified multiple times.
.TP
.B \-\-verify
Verify backup integrity after creation.
.TP
.B \-\-no\-sudo
Never attempt privilege escalation, even if required.
.TP
.B \-\-hardlink
Enable hardlinking between versions for space efficiency.
.TP
.B \-\-prune\-only
Remove old backups without creating a new one.
.SS Concurrency Control Options
.TP
.B \-\-no\-lock
Disable lockfile mechanism. DANGEROUS: allows concurrent operations that may cause corruption.
.TP
.B \-\-lock\-timeout \fISECONDS\fR
Lock acquisition timeout in seconds (default: 300).
.TP
.B \-\-force\-unlock
Force removal of stale locks from crashed processes.
.SS Restore and Compare Options
.TP
.B \-\-restore
Restore files from a checkpoint.
.TP
.B \-\-from \fIID\fR
Source checkpoint ID or path for restore operations (defaults to most recent).
.TP
.B \-\-to \fIDIR\fR
Target directory for restore operations (defaults to original location).
.TP
.B \-\-dry\-run
Preview changes without making them.
.TP
.B \-\-diff
Show differences between current files and checkpoint before restoring.
.TP
.B \-\-compare\-with \fIID\fR
Compare two checkpoints to see changes.
.TP
.B \-\-detailed
Show file content differences in comparison, not just file lists.
.TP
.B \-\-files \fIPATTERN\fR
Select specific files or patterns for selective restore. Can be specified multiple times.
.SS Metadata Options
.TP
.B \-\-desc \fITEXT\fR
Add description to checkpoint.
.TP
.B \-\-tag \fIKEY=VALUE\fR
Add searchable metadata tag. Can be specified multiple times.
.TP
.B \-\-metadata
Access checkpoint metadata subsystem.
.TP
.B \-\-show \fIID\fR
Show metadata for specific checkpoint.
.TP
.B \-\-update \fIID\fR
Update metadata for existing checkpoint.
.TP
.B \-\-find \fIPATTERN\fR
Search checkpoints by metadata pattern.
.SS Remote Operations
.TP
.B \-\-remote \fIuser@host:/path\fR
Specify remote backup location for SSH-based operations.
.TP
.B \-\-timeout \fISECONDS\fR
SSH connection timeout in seconds (default: 30).
.SH EXAMPLES
.SS Basic Operations
Create checkpoint of current directory:
.PP
.RS 4
.B checkpoint
.RE
.PP
Create checkpoint with descriptive suffix:
.PP
.RS 4
.B checkpoint -s "before-refactor"
.RE
.PP
List all checkpoints:
.PP
.RS 4
.B checkpoint --list
.RE
.PP
Restore latest checkpoint:
.PP
.RS 4
.B checkpoint --restore
.RE
.SS Development Workflow
Create checkpoint before API changes:
.PP
.RS 4
.B checkpoint -s "pre-api-refactor" --desc "Stable baseline before API changes"
.RE
.PP
Add metadata tags:
.PP
.RS 4
.B checkpoint --desc "Release candidate v2.1.0" --tag "version=2.1.0" --tag "status=testing"
.RE
.PP
Compare with previous state:
.PP
.RS 4
.B checkpoint --restore --diff
.RE
.PP
Restore specific checkpoint:
.PP
.RS 4
.B checkpoint --restore --from 20250430_091429
.RE
.SS System Administration
Backup system configuration:
.PP
.RS 4
.B sudo checkpoint -d /var/backups/system /etc
.RE
.PP
Web server configuration checkpoint:
.PP
.RS 4
.B checkpoint -s "ssl-optimization" /etc/nginx
.RE
.SS Selective Operations
Restore only JavaScript and documentation files:
.PP
.RS 4
.B checkpoint --restore --files "*.js" --files "docs/*.md"
.RE
.PP
Preview changes before restore:
.PP
.RS 4
.B checkpoint --restore --dry-run
.RE
.SS Remote Operations
Create backup on remote server:
.PP
.RS 4
.B checkpoint --remote user@host:/path/to/backups
.RE
.PP
List remote checkpoints:
.PP
.RS 4
.B checkpoint --remote user@host:/path/to/backups --list
.RE
.SS Backup Rotation
Keep only 5 most recent backups:
.PP
.RS 4
.B checkpoint --keep 5
.RE
.PP
Remove backups older than 30 days:
.PP
.RS 4
.B checkpoint --age 30
.RE
.SH ENVIRONMENT
.TP
.B CHECKPOINT_BACKUP_DIR
Default backup directory for all operations. When set, checkpoints will be stored in 
$CHECKPOINT_BACKUP_DIR/DIR_NAME/ instead of the default location.
.TP
.B CHECKPOINT_AUTO_CONFIRM
When set to 1, skip all interactive prompts. Useful for automation and CI/CD pipelines.
.SH FILES
.TP
.B ~/.checkpoint/
Default backup directory for regular users.
.TP
.B /var/backups/
Default backup directory for root users.
.TP
.B .checkpoint.lock
Lockfile created in backup directory to prevent concurrent operations.
.TP
.B checkpoint.metadata
JSON file containing checkpoint descriptions and tags.
.SH EXIT STATUS
.TP
.B 0
Success
.TP
.B 1
General error or operation failure
.TP
.B 2
Lock acquisition failure or timeout
.TP
.B 3
Invalid arguments or usage error
.TP
.B 130
Operation interrupted by user (Ctrl+C)
.SH DIAGNOSTICS
The program produces various error messages and warnings. Use
.B --verbose
for detailed output or
.B --debug
for debugging information.
.PP
Common error messages:
.IP "Permission Denied"
Use --no-sudo for user-accessible directories or ensure sudo access.
.IP "SSH Connection Failed"
Verify SSH key setup and network connectivity for remote operations.
.IP "Insufficient Disk Space"
Check available space in backup directory before large operations.
.IP "Command Not Found"
Ensure all required dependencies (rsync, find, stat) are installed.
.SH NOTES
.SS Default Exclusions
The following patterns are automatically excluded from all backups:
.IP \(bu 2
Backup directory itself (prevents recursion)
.IP \(bu 2
.gudang/, temp/, .temp/, tmp/ directories
.IP \(bu 2
Temporary files: *~ and ~*
.SS Atomic Operations
Checkpoint uses atomic operations to ensure backup integrity:
.IP \(bu 2
Backups are created in temporary .tmp.* directories
.IP \(bu 2
Only after successful completion are they renamed to final names
.IP \(bu 2
Failed operations are automatically cleaned up
.IP \(bu 2
Interrupted backups leave no trace
.SS Space Efficiency
With hardlinking enabled (--hardlink), checkpoint can achieve 90%+ space savings between
similar versions by sharing identical files across snapshots.
.SS Concurrency Protection
The lockfile mechanism prevents data corruption from concurrent operations. Each lock contains
the PID of the owning process, allowing detection and cleanup of stale locks from crashed processes.
.SH BUGS
Report bugs at https://github.com/Open-Technology-Foundation/checkpoint/issues
.SH AUTHOR
Written by the Open Technology Foundation contributors.
.SH COPYRIGHT
Copyright \(co 2025 Open Technology Foundation.
License GPLv3+: GNU GPL version 3 or later <https://gnu.org/licenses/gpl.html>.
.br
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
.SH SEE ALSO
.BR rsync (1),
.BR tar (1),
.BR cp (1),
.BR find (1),
.BR hardlink (1)
.PP
Full documentation at: https://github.com/Open-Technology-Foundation/checkpoint
```
